<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Title</title>
  </head>
  <body>
    static

    <input type="button" id="sample" value="送信" />
    <script>
      // TODO: ローカルで動くようにする
      var sock = new WebSocket("wss://" + window.location.host + "/ws");

      // 接続
      sock.addEventListener("open", function (e) {
        console.log("Socket 接続成功");
      });

      // サーバーからデータを受け取る
      sock.addEventListener("message", function (e) {
        console.log(e.data);
      });

      document.addEventListener("DOMContentLoaded", function (e) {
        // サーバーにデータを送る
        document
          .getElementById("sample")
          .addEventListener("click", function (e) {
            sock.send("hello");
          });
      });
    </script>

    <script>
      const query = Object.fromEntries(
        window.location.search
          .substr(1)
          .split("&")
          .map((group) => group.split("="))
      );
      console.log(query);
      const channels = (query["channels"] || "").split(",");
      console.log(channels);

      const xhr = new XMLHttpRequest();

      xhr.open("POST", "/api/subscriptions");
      xhr.setRequestHeader("Content-Type", "application/json");

      xhr.onerror = (e) => {
        console.log(e);
      };
      xhr.onload = () => {
        console.log(xhr.response);
      };
      console.log("post:", JSON.stringify({ channels }));
      xhr.send(JSON.stringify({ channels }));
    </script>

    <script>
      const xhr2 = new XMLHttpRequest();
      xhr2.open("GET", "/api/subscriptions");
      xhr2.onerror = (e) => {
        console.log(e);
      };
      xhr2.onload = () => {
        console.log(xhr2.response);
      };
      xhr2.send();
    </script>
  </body>
</html>
